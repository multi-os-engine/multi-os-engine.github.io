

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Working with Pointers &mdash; Multi-OS Engine Documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" href="../../../../_static/theme.css" type="text/css" />

  
      <script src="../../../../_static/documentation_options.js?v=cebfb12b"></script>
      <script src="../../../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex/" />
    <link rel="search" title="Search" href="../../../../search/" />
    <link rel="next" title="Toll-Free Bridging" href="../../toll_free_bridging/Toll_Free_Bridging/" />
    <link rel="prev" title="Nat/J Binding Generator" href="../../natjgen_binding_generator/NatJGen_Binding_Generator/" />
     
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-75001976-1', 'auto');
  ga('send', 'pageview');

</script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../" class="icon icon-home">
            Multi-OS Engine Documentation
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../../MultiOSEngine/">Multi-OS Engine</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../1_Overview/Overview/">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../2_Introduction/Introduction/">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../3_getting_started/Getting_Started/">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../4_create_ui/create_ui/">Creating Your App’s User Interface (UI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../5_using_thirdparty/using_thirdparty/">Using Third Party Native Libraries for iOS*</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../NatJ/">Nat/J library for Java to native binding</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../natj_interoperability/NatJ_Interoperability/">Nat/J: Interoperability with Native Code</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../natjgen_binding_generator/NatJGen_Binding_Generator/">Nat/J Binding Generator</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Working with Pointers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#what-are-pointers">What are pointers?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../toll_free_bridging/Toll_Free_Bridging/">Toll-Free Bridging</a></li>
<li class="toctree-l3"><a class="reference external" href="https://www.noisyfox.io/moe-native-types.html">Working with Native Types: Advanced</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../7_creating_db_app/creating_db_app/">Creating a Database App</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../8_accessWebServices/accessWebServices/">Accessing Web Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../9_game/game/">Creating a Game App</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../12_advanced/advanced/">Advanced Topics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../13_Troubleshooting/troubleshooting/">Troubleshooting tips</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../">Multi-OS Engine Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../MultiOSEngine/">Multi-OS Engine</a></li>
          <li class="breadcrumb-item"><a href="../../NatJ/">Nat/J library for Java to native binding</a></li>
      <li class="breadcrumb-item active">Working with Pointers</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../_sources/multi-os-engine/6_natj/working_with_pointers/Working_With_Pointers.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="working-with-pointers">
<h1>Working with Pointers<a class="headerlink" href="#working-with-pointers" title="Link to this heading">¶</a></h1>
<p>In this guide we will explain the usage of pointers.</p>
<section id="what-are-pointers">
<h2>What are pointers?<a class="headerlink" href="#what-are-pointers" title="Link to this heading">¶</a></h2>
<p>In C, C++, Objective-C and some other programming languages pointers are values which contains an address that refers to another value in memory. In the aforementioned languages pointers usually appear in a syntax similar to:</p>
<div class="highlight-objective-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">values</span><span class="p">;</span><span class="w"> </span><span class="c1">// Pointer to an integer type</span>
<span class="bp">NSString</span><span class="w"> </span><span class="o">*</span><span class="n">string</span><span class="p">;</span><span class="w"> </span><span class="c1">// Pointer to an NSString object</span>
</pre></div>
</div>
<p>Pointers are generally constructed with <code class="docutils literal notranslate"><span class="pre">malloc</span></code> and destructed with <code class="docutils literal notranslate"><span class="pre">free</span></code>:</p>
<div class="highlight-objective-c notranslate"><div class="highlight"><pre><span></span><span class="kt">float</span><span class="w"> </span><span class="o">*</span><span class="n">vars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mi">10</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">));</span>
<span class="n">read_values</span><span class="p">(</span><span class="n">vars</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span>
<span class="kt">float</span><span class="w"> </span><span class="n">avg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">calculate_avg</span><span class="p">(</span><span class="n">vars</span><span class="p">);</span>
<span class="n">free</span><span class="p">(</span><span class="n">vars</span><span class="p">);</span>
</pre></div>
</div>
<p>Because Multi-OS Engine has bindings for almost the complete C and Objective-C APIs in the iOS SDK, using pointers is inevitable. NatJ supports pointer usage and has the following pre-defined pointer types:</p>
<ul class="simple">
<li><p><em>VoidPtr</em> representing a <code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*</span></code></p></li>
<li><p><em>BoolPtr</em> representing a <code class="docutils literal notranslate"><span class="pre">BOOL</span> <span class="pre">*</span></code>, element size is 1 byte</p></li>
<li><p><em>BytePtr</em> representing a <code class="docutils literal notranslate"><span class="pre">char</span> <span class="pre">*</span></code>, element size is 1 byte</p></li>
<li><p><em>CharPtr</em> representing a <code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">short</span> <span class="pre">*</span></code>, element size is 2 bytes</p></li>
<li><p><em>ShortPtr</em> representing a <code class="docutils literal notranslate"><span class="pre">short</span> <span class="pre">*</span></code>, element size is 2 bytes</p></li>
<li><p><em>IntPtr</em> representing a <code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">*</span></code>, element size is 4 bytes</p></li>
<li><p><em>LongPtr</em> representing a <code class="docutils literal notranslate"><span class="pre">long</span> <span class="pre">long</span> <span class="pre">*</span></code>, element size is 8 bytes</p></li>
<li><p><em>FloatPtr</em> representing a <code class="docutils literal notranslate"><span class="pre">float</span> <span class="pre">*</span></code>, element size is 4 bytes</p></li>
<li><p><em>DoublePtr</em> representing a <code class="docutils literal notranslate"><span class="pre">double</span> <span class="pre">*</span></code>, element size is 8 bytes</p></li>
<li><p><em>NIntPtr</em> representing a <code class="docutils literal notranslate"><span class="pre">NSInteger</span> <span class="pre">*</span></code>, element size is architecture dependent</p></li>
<li><p><em>NUIntPtr</em> representing a <code class="docutils literal notranslate"><span class="pre">NSUInteger</span> <span class="pre">*</span></code>, element size is architecture dependent</p></li>
<li><p><em>NFloatPtr</em> representing a <code class="docutils literal notranslate"><span class="pre">CGFloat</span> <span class="pre">*</span></code>, element size is architecture dependent</p></li>
<li><p>And additional types for handling pointers to C structures and Objective-C objects (discussed later)</p></li>
</ul>
<p>All pointers in Java are created with the <em>PtrFactory</em> class’ static methods. The following sections will explain the different types of pointers.</p>
<section id="strong-non-guarded-pointers">
<h3>Strong Non-guarded Pointers<a class="headerlink" href="#strong-non-guarded-pointers" title="Link to this heading">¶</a></h3>
<p>PtrFactory method prefix: <code class="docutils literal notranslate"><span class="pre">new&lt;type&gt;...(...)</span></code></p>
<p>These are the most commonly used pointers. Memory to the pointed area is managed by Java’s GC.</p>
<p>Let’s look at the following problem: we want to create an NSIndexPath by using its init method which uses an NSUInteger pointer as its first argument:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// Create a NUIntPtr object with an allocated memory size of one NSUInteger</span>
<span class="n">NUIntPtr</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PtrFactory</span><span class="p">.</span><span class="na">newNUIntReference</span><span class="p">();</span>

<span class="c1">// Set the referenced memory&#39;s value to 10</span>
<span class="n">ptr</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="mi">10L</span><span class="p">);</span>

<span class="c1">// Create the NSIndexPath object</span>
<span class="n">NSIndexPath</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NSIndexPath</span><span class="p">.</span><span class="na">indexPathWithIndexesLength</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Path is &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">path</span><span class="p">);</span>
</pre></div>
</div>
<p>This code should output <code class="docutils literal notranslate"><span class="pre">Path</span> <span class="pre">is</span> <span class="pre">&lt;NSIndexPath:</span> <span class="pre">0x7c234280&gt;</span> <span class="pre">{length</span> <span class="pre">=</span> <span class="pre">1,</span> <span class="pre">path</span> <span class="pre">=</span> <span class="pre">10}</span></code></p>
<p>Another way to do this is by using another factory method, which uses the initial value as argument:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// Create a NUIntPtr object with an allocated memory size of one NSUInteger</span>
<span class="c1">// and the referenced memory&#39;s value to 10</span>
<span class="n">NUIntPtr</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PtrFactory</span><span class="p">.</span><span class="na">newNUIntReference</span><span class="p">(</span><span class="mi">10L</span><span class="p">);</span>

<span class="c1">// Create the NSIndexPath object</span>
<span class="n">NSIndexPath</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NSIndexPath</span><span class="p">.</span><span class="na">indexPathWithIndexesLength</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Path is &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">path</span><span class="p">.</span><span class="na">description</span><span class="p">());</span>
</pre></div>
</div>
<p>This should have the same result <code class="docutils literal notranslate"><span class="pre">Path</span> <span class="pre">is</span> <span class="pre">&lt;NSIndexPath:</span> <span class="pre">0x7c234370&gt;</span> <span class="pre">{length</span> <span class="pre">=</span> <span class="pre">1,</span> <span class="pre">path</span> <span class="pre">=</span> <span class="pre">10}</span></code></p>
<p>This was good for a small introduction, but let’s look at a more likely situation, that is when there are more than one elements:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// Create a NUIntPtr object with an allocated memory size of 3 NSUIntegers</span>
<span class="n">NUIntPtr</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PtrFactory</span><span class="p">.</span><span class="na">newNUIntArray</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>

<span class="c1">// Set the referenced memory&#39;s value</span>
<span class="n">ptr</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="mi">10L</span><span class="p">);</span>
<span class="n">ptr</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">20L</span><span class="p">);</span>

<span class="c1">// Create the NSIndexPath object</span>
<span class="n">NSIndexPath</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NSIndexPath</span><span class="p">.</span><span class="na">indexPathWithIndexesLength</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Path is &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">path</span><span class="p">);</span>
</pre></div>
</div>
<p>This code should output <code class="docutils literal notranslate"><span class="pre">Path</span> <span class="pre">is</span> <span class="pre">&lt;NSIndexPath:</span> <span class="pre">0x7c081d10&gt;</span> <span class="pre">{length</span> <span class="pre">=</span> <span class="pre">3,</span> <span class="pre">path</span> <span class="pre">=</span> <span class="pre">10</span> <span class="pre">-</span> <span class="pre">20</span> <span class="pre">-</span> <span class="pre">0}</span></code></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Allocated memory returned from PtrFactory is zero’d out. This is why the third element in the path above is zero.</p>
</div>
<p>As this was a more life-like scenario, for a Java programmer this is very uncomfortable, this is why we support the following solution as well:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// Create a NUIntPtr object with an allocated memory size of 2 NSUIntegers</span>
<span class="c1">// and set the referenced memory&#39;s value</span>
<span class="n">NUIntPtr</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PtrFactory</span><span class="p">.</span><span class="na">newNUIntArray</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="kt">long</span><span class="o">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">10L</span><span class="p">,</span><span class="w"> </span><span class="mi">20L</span><span class="w"> </span><span class="p">});</span>

<span class="c1">// Create the NSIndexPath object</span>
<span class="n">NSIndexPath</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NSIndexPath</span><span class="p">.</span><span class="na">indexPathWithIndexesLength</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Path is &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">path</span><span class="p">);</span>
</pre></div>
</div>
<p>Output looks like this <code class="docutils literal notranslate"><span class="pre">Path</span> <span class="pre">is</span> <span class="pre">&lt;NSIndexPath:</span> <span class="pre">0x7c08af40&gt;</span> <span class="pre">{length</span> <span class="pre">=</span> <span class="pre">2,</span> <span class="pre">path</span> <span class="pre">=</span> <span class="pre">10</span> <span class="pre">-</span> <span class="pre">20}</span></code></p>
<p>While the creation of this pointer was simpler, the results were not exactly the same. In the previous example the referenced memory size was 3 NSUIntegers while in this one it was only 2 NSUIntegers.</p>
<p>The achieve the exact results we can use the <code class="docutils literal notranslate"><span class="pre">copyFrom</span></code> method:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// Create a NUIntPtr object with an allocated memory size of 3 NSUIntegers</span>
<span class="n">NUIntPtr</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PtrFactory</span><span class="p">.</span><span class="na">newNUIntArray</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>

<span class="c1">// Set the referenced memory&#39;s value</span>
<span class="n">ptr</span><span class="p">.</span><span class="na">copyFrom</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="kt">long</span><span class="o">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">10L</span><span class="p">,</span><span class="w"> </span><span class="mi">20L</span><span class="w"> </span><span class="p">});</span>

<span class="c1">// Create the NSIndexPath object</span>
<span class="n">NSIndexPath</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NSIndexPath</span><span class="p">.</span><span class="na">indexPathWithIndexesLength</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Path is &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">path</span><span class="p">);</span>
</pre></div>
</div>
<p>Output is <code class="docutils literal notranslate"><span class="pre">Path</span> <span class="pre">is</span> <span class="pre">&lt;NSIndexPath:</span> <span class="pre">0x7c081c20&gt;</span> <span class="pre">{length</span> <span class="pre">=</span> <span class="pre">3,</span> <span class="pre">path</span> <span class="pre">=</span> <span class="pre">10</span> <span class="pre">-</span> <span class="pre">20</span> <span class="pre">-</span> <span class="pre">0}</span></code></p>
</section>
<section id="strong-guarded-pointers">
<h3>Strong Guarded Pointers<a class="headerlink" href="#strong-guarded-pointers" title="Link to this heading">¶</a></h3>
<p>PtrFactory method prefix: <code class="docutils literal notranslate"><span class="pre">newGuarded&lt;type&gt;...(...)</span></code></p>
<p>Guarded pointers add some safety to pointers (on the Java side). Accessing Non-guarded pointers are a bit faster, but those require much more attention at indexing, because indexing outside the memory’s bounds will not throw an exception rather the application will most likely crash due to a segmentation fault.
Guarded pointers however will do an index check and will throw an <code class="docutils literal notranslate"><span class="pre">IndexOutOfBoundsException</span></code> when needed.</p>
<p>Here’s a simple example where the guard saved us:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// Create a ShortPtr object with an allocated memory size of 5 shorts</span>
<span class="n">ShortPtr</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PtrFactory</span><span class="p">.</span><span class="na">newGuardedShortArray</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>

<span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Index outside of the allocated memory</span>
<span class="w">        </span><span class="n">ptr</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">short</span><span class="p">)</span><span class="w"> </span><span class="mi">100</span><span class="p">);</span>
<span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IndexOutOfBoundsException</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Index was out of bounds!&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The output is <code class="docutils literal notranslate"><span class="pre">Index</span> <span class="pre">was</span> <span class="pre">out</span> <span class="pre">of</span> <span class="pre">bounds!</span></code> instead of an embarrassing application crash.</p>
<p>Guarded pointers can be created from Non-guarded pointers via the <code class="docutils literal notranslate"><span class="pre">getGuarded</span></code> method, but NatJ relies on the programmer to specify the bounds correctly.</p>
</section>
<section id="weak-non-guarded-pointers">
<h3>Weak Non-guarded Pointers<a class="headerlink" href="#weak-non-guarded-pointers" title="Link to this heading">¶</a></h3>
<p>PtrFactory method prefix: <code class="docutils literal notranslate"><span class="pre">newWeak&lt;type&gt;...(...)</span></code></p>
<p>Weak pointers differ from strong pointers in only one way, memory management is completely manual. This is useful when doing optimizations, for example:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// Create a CharPtr object with an allocated memory size of 5 chars</span>
<span class="c1">// and set the referenced memory&#39;s value to &#39;Hello&#39;</span>
<span class="n">CharPtr</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PtrFactory</span><span class="p">.</span><span class="na">newWeakCharArray</span><span class="p">(</span><span class="s">&quot;Hello&quot;</span><span class="p">.</span><span class="na">toCharArray</span><span class="p">());</span>

<span class="c1">// Create an NSString object from the pointer and make NSString responsible</span>
<span class="c1">// for deallocation the pointer</span>
<span class="n">NSString</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NSString</span><span class="p">.</span><span class="na">alloc</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">initWithCharactersNoCopyLengthFreeWhenDone</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;My value is &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">string</span><span class="p">);</span>
</pre></div>
</div>
<p>The code should print <code class="docutils literal notranslate"><span class="pre">My</span> <span class="pre">value</span> <span class="pre">is</span> <span class="pre">Hello</span></code></p>
<p>In this scenario this was useful because we didn’t copy the entire string when the NSString was initialized, rather we simply passed the pointer to it. When working with large amounts of data this could save a lot of time and memory!</p>
</section>
<section id="weak-guarded-pointers">
<h3>Weak Guarded Pointers<a class="headerlink" href="#weak-guarded-pointers" title="Link to this heading">¶</a></h3>
<p>PtrFactory method prefix: <code class="docutils literal notranslate"><span class="pre">newGuardedWeak&lt;type&gt;..(...)</span></code></p>
<p>Weak Non-guarded pointers have the same relation with weak guarded pointers as strong non-guarded with strong guarded pointers.</p>
</section>
<section id="retrieving-values">
<h3>Retrieving Values<a class="headerlink" href="#retrieving-values" title="Link to this heading">¶</a></h3>
<p>Retrieving values can be done in multiple ways, of which the simplest are the <code class="docutils literal notranslate"><span class="pre">get</span></code> and <code class="docutils literal notranslate"><span class="pre">toArray</span></code> method variants.</p>
<p>Here is a simple example:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// Create a green UIColor</span>
<span class="n">UIColor</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UIColor</span><span class="p">.</span><span class="na">greenColor</span><span class="p">();</span>

<span class="c1">// Create a pointer where the hue value will be stored</span>
<span class="n">NFloatPtr</span><span class="w"> </span><span class="n">hue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PtrFactory</span><span class="p">.</span><span class="na">newNFloatReference</span><span class="p">();</span>

<span class="c1">// Retrieve the hue value</span>
<span class="n">color</span><span class="p">.</span><span class="na">getHueSaturationBrightnessAlpha</span><span class="p">(</span><span class="n">hue</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Hue of color is &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">hue</span><span class="p">.</span><span class="na">get</span><span class="p">());</span>
</pre></div>
</div>
<p>The code will print something like this <code class="docutils literal notranslate"><span class="pre">Hue</span> <span class="pre">of</span> <span class="pre">color</span> <span class="pre">is</span> <span class="pre">0.3333333432674408</span></code></p>
</section>
<section id="pointer-offsetting">
<h3>Pointer Offsetting<a class="headerlink" href="#pointer-offsetting" title="Link to this heading">¶</a></h3>
<p>Offsetting pointers can be useful in various ways that we will not go into, but instead show how to actually do it. The most important thing to know is that <strong>offsetted pointers still point to the memory region of the original pointer!</strong></p>
<p>Let’s look at the next example where we want to copy ‘Hello’ five times after each other. One solution to this would be using the correct <code class="docutils literal notranslate"><span class="pre">copyFrom</span></code> method which can specify the target offset. The other solution is using pointer offsets:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// Create a CharPtr object with an allocated memory size of 25 chars</span>
<span class="n">CharPtr</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PtrFactory</span><span class="p">.</span><span class="na">newCharArray</span><span class="p">(</span><span class="mi">25</span><span class="p">);</span>

<span class="c1">// Set the offsetted memory&#39;s value &#39;Hello&#39;</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">idx</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">25</span><span class="p">;</span><span class="w"> </span><span class="n">idx</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ptr</span><span class="p">.</span><span class="na">ofs</span><span class="p">(</span><span class="n">idx</span><span class="p">).</span><span class="na">copyFrom</span><span class="p">(</span><span class="s">&quot;Hello&quot;</span><span class="p">.</span><span class="na">toCharArray</span><span class="p">());</span>
<span class="p">}</span>

<span class="c1">// Create an NSString object from the pointer</span>
<span class="n">NSString</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NSString</span><span class="p">.</span><span class="na">alloc</span><span class="p">().</span><span class="na">initWithCharactersLength</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="p">);</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;5 * &#39;Hello&#39; = &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">string</span><span class="p">);</span>
</pre></div>
</div>
<p>The output is <code class="docutils literal notranslate"><span class="pre">5</span> <span class="pre">*</span> <span class="pre">'Hello'</span> <span class="pre">=</span> <span class="pre">HelloHelloHelloHelloHello</span></code></p>
<p>Because the offsetted pointer always points to the original memory region, this code is also valid:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// Create a CharPtr object with an allocated memory size of 25 chars</span>
<span class="n">CharPtr</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PtrFactory</span><span class="p">.</span><span class="na">newCharArray</span><span class="p">(</span><span class="mi">25</span><span class="p">);</span>

<span class="c1">// Set the offsetted memory&#39;s value &#39;Hello&#39; and re-offset the pointer</span>
<span class="n">CharPtr</span><span class="w"> </span><span class="n">ofs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ptr</span><span class="p">;</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">idx</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">idx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ofs</span><span class="p">.</span><span class="na">copyFrom</span><span class="p">(</span><span class="s">&quot;Hello&quot;</span><span class="p">.</span><span class="na">toCharArray</span><span class="p">());</span>
<span class="w">        </span><span class="n">ofs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ofs</span><span class="p">.</span><span class="na">ofs</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Create an NSString object from the pointer</span>
<span class="n">NSString</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NSString</span><span class="p">.</span><span class="na">alloc</span><span class="p">().</span><span class="na">initWithCharactersLength</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="p">);</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;5 * &#39;Hello&#39; = &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">string</span><span class="p">);</span>
</pre></div>
</div>
<p>Again, the output will be <code class="docutils literal notranslate"><span class="pre">5</span> <span class="pre">*</span> <span class="pre">'Hello'</span> <span class="pre">=</span> <span class="pre">HelloHelloHelloHelloHello</span></code></p>
<p>Here’s an example of using pointer offsetting instead of four NFloatPtrs:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// Create a blue UIColor</span>
<span class="n">UIColor</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UIColor</span><span class="p">.</span><span class="na">blueColor</span><span class="p">();</span>

<span class="c1">// Create a pointer where the 4 components of HSBA will be stored</span>
<span class="n">NFloatPtr</span><span class="w"> </span><span class="n">cmps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PtrFactory</span><span class="p">.</span><span class="na">newNFloatArray</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>

<span class="c1">// Retrieve the HSBA values</span>
<span class="n">color</span><span class="p">.</span><span class="na">getHueSaturationBrightnessAlpha</span><span class="p">(</span><span class="n">cmps</span><span class="p">,</span><span class="w"> </span><span class="n">cmps</span><span class="p">.</span><span class="na">ofs</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">cmps</span><span class="p">.</span><span class="na">ofs</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="n">cmps</span><span class="p">.</span><span class="na">ofs</span><span class="p">(</span><span class="mi">3</span><span class="p">));</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;HSBA values are &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="n">cmps</span><span class="p">.</span><span class="na">toArray</span><span class="p">(</span><span class="mi">4</span><span class="p">)));</span>
</pre></div>
</div>
<p>Output is <code class="docutils literal notranslate"><span class="pre">HSBA</span> <span class="pre">values</span> <span class="pre">are</span> <span class="pre">[0.6666666865348816,</span> <span class="pre">1.0,</span> <span class="pre">1.0,</span> <span class="pre">1.0]</span></code></p>
</section>
<section id="c-structure-pointers">
<h3>C Structure Pointers<a class="headerlink" href="#c-structure-pointers" title="Link to this heading">¶</a></h3>
<p>C structure pointers are bound a bit differently than other pointers because the interpretation of how the code should be bound relies on the context it is used in. It can be either a reference to a single structure or a pointer to multiple structures.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The binding code for some of these methods will be changed to better reflect the function of them!</p>
</div>
<p>In the next example we will show you how structure references work:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// Create a CGRect object representing {{0, 0}, {200, 100}}</span>
<span class="n">CGRect</span><span class="w"> </span><span class="n">rect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CGRect</span><span class="p">(</span><span class="n">CoreGraphics</span><span class="p">.</span><span class="na">CGPointZero</span><span class="p">(),</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CGSize</span><span class="p">(</span><span class="mf">200.0</span><span class="p">,</span><span class="w"> </span><span class="mf">100.0</span><span class="p">));</span>

<span class="c1">// Create two more rects for the slice and remainder</span>
<span class="n">CGRect</span><span class="w"> </span><span class="n">slice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CGRect</span><span class="p">();</span>
<span class="n">CGRect</span><span class="w"> </span><span class="n">remainder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CGRect</span><span class="p">();</span>

<span class="c1">// Divide the rect</span>
<span class="n">CoreGraphics</span><span class="p">.</span><span class="na">CGRectDivide</span><span class="p">(</span><span class="n">rect</span><span class="p">,</span><span class="w"> </span><span class="n">slice</span><span class="p">,</span><span class="w"> </span><span class="n">remainder</span><span class="p">,</span><span class="w"> </span><span class="mf">50.0</span><span class="p">,</span><span class="w"> </span><span class="n">CGRectEdge</span><span class="p">.</span><span class="na">MinXEdge</span><span class="p">);</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Slice is &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">UIKit</span><span class="p">.</span><span class="na">NSStringFromCGRect</span><span class="p">(</span><span class="n">slice</span><span class="p">));</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Remainder is &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">UIKit</span><span class="p">.</span><span class="na">NSStringFromCGRect</span><span class="p">(</span><span class="n">remainder</span><span class="p">));</span>
</pre></div>
</div>
</section>
<section id="objective-c-object-pointers">
<h3>Objective-C Object Pointers<a class="headerlink" href="#objective-c-object-pointers" title="Link to this heading">¶</a></h3>
<p>These pointers are often not too useful, but there are some very good exceptions. The iOS SDK usually does not use exceptions for error handling, rather it uses pointers to NSError objects. Here is an example for how error handling can be implemented with error information provided by NSError:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// Create a NSURL to a non-existent website</span>
<span class="n">NSURL</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NSURL</span><span class="p">.</span><span class="na">URLWithString</span><span class="p">(</span><span class="s">&quot;https://www.invalid.url/nothinghere&quot;</span><span class="p">);</span>

<span class="c1">// Create the NSError pointer</span>
<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">NSError</span><span class="o">&gt;</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PtrFactory</span><span class="p">.</span><span class="na">newObjectReference</span><span class="p">(</span><span class="n">NSError</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>

<span class="c1">// Try to create a NSString from the bad URL</span>
<span class="n">NSString</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NSString</span><span class="p">.</span><span class="na">stringWithContentsOfURLEncodingError</span><span class="p">(</span><span class="n">url</span><span class="p">,</span>
<span class="w">                </span><span class="n">Enums</span><span class="p">.</span><span class="na">NSUTF8StringEncoding</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="p">);</span>

<span class="c1">// Handle error</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">string</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">error</span><span class="p">.</span><span class="na">get</span><span class="p">().</span><span class="na">localizedDescription</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Output will be something like: <code class="docutils literal notranslate"><span class="pre">The</span> <span class="pre">operation</span> <span class="pre">couldn’t</span> <span class="pre">be</span> <span class="pre">completed.</span> <span class="pre">(Cocoa</span> <span class="pre">error</span> <span class="pre">256.)</span></code></p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../../natjgen_binding_generator/NatJGen_Binding_Generator/" class="btn btn-neutral float-left" title="Nat/J Binding Generator" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../toll_free_bridging/Toll_Free_Bridging/" class="btn btn-neutral float-right" title="Toll-Free Bridging" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Intel Corporation, Migeran &amp; Multi-OS Engine Community.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <header>
  <div class="header__container">
    <a href="http://doc.multi-os-engine.org/" class="header__logo">
      <img width="176" src="../../../../_static/moelogo-02.png">
    </a>
    <div class="links__icon">
      <i class="fa fa-bars"></i>
    </div>
    <ul class="header__links">
      
        <li><a href="https://multi-os-engine.org/">Home</a></li>
        <li><a href="https://multi-os-engine.org/features/">Features</a></li>
        <li><a href="https://doc.multi-os-engine.org">Docs</a></li>
        <li><a href="https://multi-os-engine.org/blog/">Blog</a></li>
        <li><a href="https://multi-os-engine.org/support/">Support</a></li>
        <li><a href="https://discuss.multi-os-engine.org">Forum</a></li>
        <li><a href="https://discord.gg/m5t3qNXTWj">Discord</a></li>
        <li><a href="https://github.com/multi-os-engine/multi-os-engine">GitHub</a></li>
    </ul>
  </div>
</header>


</body>
</html>
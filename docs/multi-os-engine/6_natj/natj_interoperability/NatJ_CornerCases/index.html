

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nat/J: Corner Cases &mdash; Multi-OS Engine Documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" href="../../../../_static/theme.css" type="text/css" />

  
      <script src="../../../../_static/documentation_options.js?v=cebfb12b"></script>
      <script src="../../../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex/" />
    <link rel="search" title="Search" href="../../../../search/" />
    <link rel="next" title="Nat/J: Reference" href="../natj_reference/packages/" />
    <link rel="prev" title="Using the NatJ Library" href="../NatJ_How_to/" />
     
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-75001976-1', 'auto');
  ga('send', 'pageview');

</script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../" class="icon icon-home">
            Multi-OS Engine Documentation
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../../MultiOSEngine/">Multi-OS Engine</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../1_Overview/Overview/">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../2_Introduction/Introduction/">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../3_getting_started/Getting_Started/">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../4_create_ui/create_ui/">Creating Your App’s User Interface (UI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../5_using_thirdparty/using_thirdparty/">Using Third Party Native Libraries for iOS*</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../NatJ/">Nat/J library for Java to native binding</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../NatJ_Interoperability/">Nat/J: Interoperability with Native Code</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../NatJ_How_to/">Using the NatJ Library</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Nat/J: Corner Cases</a></li>
<li class="toctree-l4"><a class="reference internal" href="../natj_reference/packages/">Nat/J: Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../natjgen_binding_generator/NatJGen_Binding_Generator/">Nat/J Binding Generator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../working_with_pointers/Working_With_Pointers/">Working with Pointers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../toll_free_bridging/Toll_Free_Bridging/">Toll-Free Bridging</a></li>
<li class="toctree-l3"><a class="reference external" href="https://www.noisyfox.io/moe-native-types.html">Working with Native Types: Advanced</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../7_creating_db_app/creating_db_app/">Creating a Database App</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../8_accessWebServices/accessWebServices/">Accessing Web Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../9_game/game/">Creating a Game App</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../12_advanced/advanced/">Advanced Topics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../13_Troubleshooting/troubleshooting/">Troubleshooting tips</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../">Multi-OS Engine Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../MultiOSEngine/">Multi-OS Engine</a></li>
          <li class="breadcrumb-item"><a href="../../NatJ/">Nat/J library for Java to native binding</a></li>
          <li class="breadcrumb-item"><a href="../NatJ_Interoperability/">Nat/J: Interoperability with Native Code</a></li>
      <li class="breadcrumb-item active">Nat/J: Corner Cases</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../_sources/multi-os-engine/6_natj/natj_interoperability/NatJ_CornerCases.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="nat-j-corner-cases">
<h1>Nat/J: Corner Cases<a class="headerlink" href="#nat-j-corner-cases" title="Link to this heading">¶</a></h1>
<p>In this section some corner cases get mentioned that requires great care and attention to avoid any inconveniences.</p>
<p><strong>Non-Retained Problem</strong></p>
<p>In Objective-C* memory management there are three main property qualifiers: copy, strong (retain), assign.</p>
<ul class="simple">
<li><p>When a property is marked as copy, then the assigned object will be copied (through the <code class="docutils literal notranslate"><span class="pre">NSCopying</span></code> protocol).</p></li>
<li><p>When a property is marked as strong, then the assigned object will be retained (its reference count will be incremented).</p></li>
<li><p>But when a property is marked with assign, then only the value will be set.</p></li>
</ul>
<p>A problem is caused by the last statement when working with Objective-C binding methods in Java*, because the binding
method’s parameter is not marked with this information, only the documentation contains this information.</p>
<p><em>As a workaround, Apple iOS</em> binding code has safe and unsafe versions of a non-retained property setter method.* The safe setter
creates a reference for the specified object on the Java side to prevent unwanted freeing from the GC and the unsafe setter
simply invokes the Objective-C code.</p>
<p>Let’s look at this simple example where we have two main classes:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">MyDataSource</span></code> - which is a simple class extending <code class="docutils literal notranslate"><span class="pre">NSObject</span></code> and implementing <code class="docutils literal notranslate"><span class="pre">UITableViewDataSource</span></code>. This class stores
all the row information and everything related to being a datasource.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TableController</span></code> - which is a view controller extending <code class="docutils literal notranslate"><span class="pre">UITableViewController</span></code>. This will be our root view controller.</p></li>
</ul>
</div></blockquote>
<p>Let’s say this is our <code class="docutils literal notranslate"><span class="pre">viewDidLoad</span></code> method:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="nd">@Selector</span><span class="p">(</span><span class="s">&quot;viewDidLoad&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">viewDidLoad</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">super</span><span class="p">.</span><span class="na">viewDidLoad</span><span class="p">();</span>

<span class="w">        </span><span class="n">tableView</span><span class="p">().</span><span class="na">registerClassForCellReuseIdentifier</span><span class="p">(</span>
<span class="w">                        </span><span class="k">new</span><span class="w"> </span><span class="n">org</span><span class="p">.</span><span class="na">moe</span><span class="p">.</span><span class="na">natj</span><span class="p">.</span><span class="na">objc</span><span class="p">.</span><span class="na">Class</span><span class="p">(</span><span class="s">&quot;UITableViewCell&quot;</span><span class="p">),</span>
<span class="w">                        </span><span class="n">MyDataSource</span><span class="p">.</span><span class="na">CELL_IDENTIFIER</span><span class="p">);</span>

<span class="w">        </span><span class="n">MyDataSource</span><span class="w"> </span><span class="n">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyDataSource</span><span class="p">.</span><span class="na">alloc</span><span class="p">().</span><span class="na">init</span><span class="p">();</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10000</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">source</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">tableView</span><span class="p">().</span><span class="na">setDataSource_unsafe</span><span class="p">(</span><span class="n">source</span><span class="p">);</span>
<span class="w">        </span><span class="n">tableView</span><span class="p">().</span><span class="na">reloadData</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We basically register a cell reuse identifier with the table view, fill up the data source with 10000 rows, set the data source
property of the table view and reload the data.</p>
<p>The code looks ok and you could probably even start the application without any issues. The problem will only occur when Java
VM’s garbage collector decides to do a cleanup. The garbage collector has no idea that it needs to keep the Java <code class="docutils literal notranslate"><span class="pre">MyDataSource</span></code>
object alive - because the only reference to it is on the Objective-C side - and frees it, but <code class="docutils literal notranslate"><span class="pre">UITableView</span></code>’s data source
handling is very dynamic, so when the user scrolls after the GC freeing, the table view will ask the data source about the next
row it needs to display (and other info as well), but at that point the object was already freed thus causing an <code class="docutils literal notranslate"><span class="pre">EXC_BAD_ACCESS</span></code>
exception or rendering the application unusable.</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../NatJ_How_to/" class="btn btn-neutral float-left" title="Using the NatJ Library" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../natj_reference/packages/" class="btn btn-neutral float-right" title="Nat/J: Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Intel Corporation, Migeran &amp; Multi-OS Engine Community.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <header>
  <div class="header__container">
    <a href="http://doc.multi-os-engine.org/" class="header__logo">
      <img width="176" src="../../../../_static/moelogo-02.png">
    </a>
    <div class="links__icon">
      <i class="fa fa-bars"></i>
    </div>
    <ul class="header__links">
      
        <li><a href="https://multi-os-engine.org/">Home</a></li>
        <li><a href="https://multi-os-engine.org/features/">Features</a></li>
        <li><a href="https://doc.multi-os-engine.org">Docs</a></li>
        <li><a href="https://multi-os-engine.org/blog/">Blog</a></li>
        <li><a href="https://multi-os-engine.org/support/">Support</a></li>
        <li><a href="https://discuss.multi-os-engine.org">Forum</a></li>
        <li><a href="https://discord.gg/m5t3qNXTWj">Discord</a></li>
        <li><a href="https://github.com/multi-os-engine/multi-os-engine">GitHub</a></li>
    </ul>
  </div>
</header>


</body>
</html>